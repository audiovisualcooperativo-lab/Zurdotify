:root {
    --bg: #0b0b10;
    --panel: #13131a;
    --glass: #14141d;
    --text: #e9f1ff;
    --muted: #9fb2c6;
    --border: rgba(255,255,255,.08);
    --pad: clamp(12px,3.5vw,18px);
    --radius: 14px;
    --radius-lg: 16px;
    --a1: #00d3ff;
    --a2: #ff58d6;
    --a3: #3dff7a;
    --player-h: 140px;
    --hover-glow: 0 0 12px rgba(0, 211, 255, 0.6);
    --hover-transition: all 0.25s ease;
}
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}
html, body {
    height: 100%;
}
body {
    min-height: 100svh;
    height: 100dvh;
    display: grid;
    grid-template-rows: auto 1fr auto;
    color: var(--text);
    background: var(--bg);
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans";
    font-size: clamp(15px, 1.1vw + .6rem, 16px);
    line-height: 1.35;
    overflow: auto;
    -webkit-tap-highlight-color: transparent;
}
.only-mobile {
    display: inline-flex;
}
.only-desktop {
    display: none;
}
@media (min-width:900px) {
    .only-mobile {
        display: none;
    }
    .only-desktop {
        display: flex;
    }
}
.bg-layer {
    position: fixed;
    inset: 0;
    z-index: -2;
    pointer-events: none;
    background: radial-gradient(40vmax 40vmax at 10% 15%, rgba(0,211,255,.12), transparent 60%), radial-gradient(36vmax 36vmax at 80% 8%, rgba(255,88,214,.10), transparent 60%), linear-gradient(180deg, #09090e, #0c0c12);
}
header {
    position: sticky;
    top: 0;
    z-index: 100;
    display: grid;
    grid-template-columns: auto 1fr auto auto;
    gap: 10px;
    align-items: center;
    padding: 10px var(--pad);
    background: linear-gradient(180deg, rgba(10,10,15,.9), rgba(10,10,15,.6));
    border-bottom: 1px solid var(--border);
    backdrop-filter: blur(10px);
}
@media (min-width:900px) {
    header {
        grid-template-columns: auto 1fr auto;
    }
}
.logo {
    font-family: "Sedgwick Ave Display", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans";
    font-weight: 900;
    letter-spacing: .4px;
    font-size: clamp(22px, 3.2vw, 30px);
    background: linear-gradient(90deg, var(--a1), var(--a2));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    -webkit-text-stroke: 1px rgba(0,0,0,.38);
    text-shadow:
        0 2px 0 rgba(0,0,0,.25),
        0 0 14px rgba(0,211,255,.35);
    transform: rotate(-1deg);
}
@media (min-width:900px) {
  .logo { transform: rotate(-1.5deg) skewX(-1deg); }
}
.icon-btn {
    background: #151525;
    color: var(--text);
    border: 1px solid var(--border);
    font-size: 20px;
    padding: 10px 12px;
    border-radius: 12px;
    cursor: pointer;
    transition: var(--hover-transition);
}
.icon-btn:hover {
    box-shadow: var(--hover-glow);
    transform: translateY(-2px);
}
.search {
    display: flex;
    gap: 10px;
    align-items: center;
}
.search input {
    width: 100%;
    padding: 12px 14px;
    border-radius: 12px;
    background: #12121a;
    color: #e9f1ff;
    border: 1px solid var(--border);
    outline: none;
    transition: var(--hover-transition);
}
.search input:focus {
    border-color: var(--a1);
    box-shadow: var(--hover-glow);
}
.filters-inline {
    display: none;
}
@media (min-width:900px) {
    .filters-inline {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    .chip {
        font-size: 12px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--border);
        background: #151525;
        color: #e6f6ff;
        white-space: nowrap;
        cursor: pointer;
        transition: var(--hover-transition);
    }
    .chip:hover {
        transform: scale(1.05);
        box-shadow: var(--hover-glow);
    }
    .chip.on {
        border-color: rgba(0,211,255,.6);
    }
    .switch {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
    }
    .switch input {
        appearance: none;
        width: 42px;
        height: 24px;
        border-radius: 999px;
        background: #1a1a26;
        border: 1px solid var(--border);
        position: relative;
        cursor: pointer;
        transition: var(--hover-transition);
    }
    .switch input:hover {
        box-shadow: var(--hover-glow);
    }
    .switch input::after {
        content: "";
        position: absolute;
        top: 2px;
        left: 2px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #dff6ff;
    }
    .switch input:checked {
        background: linear-gradient(90deg, rgba(0,211,255,.35), rgba(255,88,214,.30));
    }
    .switch input:checked::after {
        left: 20px;
        background: #071015;
    }
}
.layout {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
    height: auto;
    padding: 0 var(--pad);
}
.sidebar {
    background: #101018;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px;
    min-height: 0;
    overflow: auto;
}
@media (max-width:899px) {
    .sidebar {
        position: fixed;
        top: 64px;
        left: 0;
        bottom: 0;
        width: min(86vw,360px);
        transform: translateX(-100%);
        transition: transform .2s ease;
        z-index: 55;
    }
    .sidebar.open {
        transform: translateX(0);
    }
}
.sidebar details {
    background: #11111a;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 6px;
    margin-bottom: 10px;
}
.sidebar summary {
    cursor: pointer;
    padding: 8px;
    border-radius: 8px;
    list-style: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: var(--hover-transition);
}
.sidebar summary:hover {
    background: rgba(255,255,255,0.05);
}
.sidebar summary::-webkit-details-marker {
    display: none;
}
.sidebar h2 {
    font-size: 12px;
    color: #9fb2c6;
    text-transform: uppercase;
}
.acc-body {
    margin-top: 8px;
}
.album {
    display: grid;
    grid-template-columns: 56px 1fr auto;
    gap: 10px;
    align-items: center;
    padding: 8px;
    border-radius: 12px;
    background: #101018;
    border: 1px solid var(--border);
    margin-bottom: 8px;
    cursor: pointer;
    transition: var(--hover-transition);
}
.album:hover {
    transform: translateY(-3px);
    box-shadow: var(--hover-glow);
    border-color: var(--a1);
}
.album.active {
    outline: 1px solid rgba(0,211,255,.5);
}
.cover {
    width: 56px;
    height: 56px;
    border-radius: 10px;
    object-fit: cover;
    background: #0f0f16;
}
.src-badge {
    font-size: 10px;
    border: 1px solid var(--border);
    padding: 1px 6px;
    border-radius: 999px;
    margin-left: 6px;
    color: #cfeeff;
}
/* === Badge: Alquimix recommended => gold star only === */
.src-badge.alq {
  /* Show only a gold star, no extra text */
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 18px;
  height: 18px;
  padding: 0;
  border: none;
  border-radius: 50%;
  background: transparent;
  color: #FFD54A;     /* fallback color */
  font-size: 0 !important; /* hide any inner text if present */
}

/* Ensure visible golden star for Alquimix badge, even if inner text is hidden */
.src-badge.alq::before {
  content: "★";
  font-size: 12px;
  line-height: 1;
  color: #FFD54A;
  display: inline-block;
  transform: translateY(-1px);
}

.downloads {
    font-size: 11px;
    color: #9fb2c6;
}
.pl-empty, .empty {
    color: #cbd8eb;
    padding: 12px;
    text-align: center;
}
.content {
    padding: 12px 0;
    padding-bottom: calc(var(--player-h) + 24px);
    display: grid;
    gap: 12px;
}
.album-hero {
    display: grid;
    grid-template-columns: 120px 1fr;
    gap: 12px;
    align-items: center;
    background: #101018;
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 12px;
}
@media (min-width:900px) {
    .album-hero {
        grid-template-columns: 180px 1fr;
    }
}
.album-hero .hero-cover {
    width: 120px;
    aspect-ratio: 1;
    border-radius: 12px;
    object-fit: cover;
}
@media (min-width:900px) {
    .album-hero .hero-cover {
        width: 180px;
    }
}
.album-hero h1 {
    font-size: clamp(18px, 2.2vw, 22px);
}
.album-hero .sub {
    color: #9fb2c6;
    font-size: 13px;
}
.actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 8px;
}
.btn {
    background: linear-gradient(90deg, var(--a1), var(--a2));
    color: #001018;
    border: none;
    font-weight: 800;
    padding: 10px 14px;
    border-radius: 999px;
    cursor: pointer;
    transition: var(--hover-transition);
}
.btn:hover {
    transform: translateY(-3px);
    box-shadow: var(--hover-glow);
}
.btn.secondary {
    background: #131321;
    color: var(--text);
    border: 1px solid var(--border);
}
.tracks {
    background: #101018;
    border: 1px solid var(--border);
    border-radius: 14px;
    overflow: visible;
}
.tracks header {
    display: none;
}
@media (min-width:900px) {
    .tracks header {
        display: grid;
        grid-template-columns: 1fr 120px 100px;
        gap: 8px;
        padding: 10px 14px;
        background: #0e0e16;
        border-bottom: 1px solid var(--border);
    }
}
.track-row {
    display: grid;
    grid-template-columns: 1fr auto auto;
    gap: 10px;
    align-items: center;
    padding: 12px;
    border-top: 1px solid rgba(255,255,255,.06);
    transition: var(--hover-transition);
}
.track-row:hover {
    background: rgba(255,255,255,0.05);
    transform: translateX(5px);
    box-shadow: var(--hover-glow);
}
.track-row:first-child {
    border-top: none;
}
@media (min-width:900px) {
    .track-row {
        grid-template-columns: 1fr 120px 100px;
    }
}
.t-title {
    display: flex;
    gap: 10px;
    align-items: center;
    min-width: 0;
}
.t-title .index {
    width: 28px;
    height: 28px;
    border-radius: 999px;
    background: #0f1620;
    display: grid;
    place-items: center;
    font-size: 12px;
    color: #cde6ff;
}
.t-title .name {
    font-weight: 700;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.t-title .format {
    font-size: 11px;
    color: #b7d3ec;
}
.t-dur {
    font-size: 12px;
    color: #cfe4f9;
    text-align: right;
}
.t-more .icon-btn {
    font-size: 20px;
    padding: 8px 10px;
}
.t-meta {
    grid-column: 1/-1;
}
.tags {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}
.tag {
    font-size: 11px;
    color: #cfe8ff;
    background: #151525;
    border: 1px solid var(--border);
    padding: 2px 8px;
    border-radius: 999px;
    transition: var(--hover-transition);
}
.tag:hover {
    transform: scale(1.05);
    box-shadow: var(--hover-glow);
}
.sm-btn {
    font-size: 12px;
    padding: 6px 10px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: #151525;
    color: var(--text);
    transition: var(--hover-transition);
}
.sm-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--hover-glow);
}
@media (max-width:899px) {
    .sm-btn.add {
        display: none;
    }
}
.player {
    position: sticky;
    bottom: 0;
    z-index: 30;
    display: grid;
    grid-template-columns: 1fr;
    gap: 10px;
    padding: 10px var(--pad);
    padding-bottom: calc(10px + env(safe-area-inset-bottom));
    background: linear-gradient(180deg, rgba(12,12,18,.88), rgba(12,12,18,.95));
    border-top: 1px solid var(--border);
}
.p-left {
    display: flex;
    align-items: center;
    gap: 10px;
    min-width: 0;
}
.p-cover {
    width: 48px;
    height: 48px;
    border-radius: 10px;
    object-fit: cover;
    background: #0f0f16;
}
.p-title {
    font-size: 14px;
    font-weight: 800;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.p-artist {
    font-size: 12px;
    color: #9fb2c6;
}
.buttons {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
}
.play {
    font-size: 26px;
}
.volwrap {
    display: none;
}
@media (min-width:900px) {
    .volwrap {
        display: flex;
        align-items: center;
        gap: 10px;
    }
}
.more-btn {
    margin-left: auto;
}
@media (min-width:900px) {
    .more-btn {
        display: none;
    }
}
.progress {
    display: grid;
    grid-template-columns: 42px 1fr 42px;
    gap: 8px;
    align-items: center;
}
.time {
    font-size: 12px;
    color: #cde9ff;
    text-align: center;
}
.bar {
    height: 10px;
    background: #1a1a24;
    border-radius: 999px;
    position: relative;
    cursor: pointer;
    touch-action: none;
}
.fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--a1), var(--a2), var(--a3));
    border-radius: 999px;
}
.fill::after {
    content: "";
    position: absolute;
    right: -7px;
    top: 50%;
    transform: translateY(-50%);
    width: 14px;
    height: 14px;
    background: #fff;
    border-radius: 50%;
}
.mini {
    position: fixed;
    left: 12px;
    right: 12px;
    bottom: calc(12px + env(safe-area-inset-bottom));
    z-index: 50;
    display: none;
    background: #11111a;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px;
}
.mini .row {
    display: flex;
    align-items: center;
    gap: 10px;
}
.mini .cover {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    object-fit: cover;
    background: #0f0f16;
}
.mini .title {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.mini .btns {
    display: flex;
    gap: 8px;
}
.mini details.mini-menu {
    margin-left: auto;
    position: relative;
    z-index: 60;
}
.mini details.mini-menu summary {
    list-style: none;
}
.mini details.mini-menu summary::-webkit-details-marker {
    display: none;
}
.mini details.mini-menu .menu-btn {
    cursor: pointer;
}
.mini details.mini-menu[open] .menu-panel {
    display: block;
}
.mini .menu-panel {
    display: none;
    position: absolute;
    right: 0;
    bottom: calc(100% + 8px);
    min-width: 220px;
    background: #0f0f16;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,.4);
}
.mini .menu-panel .row {
    display: flex;
    gap: 8px;
    align-items: center;
    margin: 6px 0;
    flex-wrap: wrap;
}
.mini .menu-panel h4 {
    font-size: 12px;
    color: #cfe8ff;
    text-transform: uppercase;
    letter-spacing: .04em;
    margin: 4px 0;
}
.sheet {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 60;
    display: none;
    background: #0f0f16;
    border-top: 1px solid var(--border);
    border-radius: 16px 16px 0 0;
    padding: 14px;
}
.sheet .row {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
    margin: 8px 0;
}
.sheet h3 {
    font-size: 14px;
    text-transform: uppercase;
    color: #cfe8ff;
    letter-spacing: .06em;
}
.sheet .switch {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
}
.sheet .switch input {
    appearance: none;
    width: 46px;
    height: 26px;
    border-radius: 999px;
    background: #1a1a26;
    border: 1px solid var(--border);
    position: relative;
}
.sheet .switch input::after {
    content: "";
    position: absolute;
    top: 2px;
    left: 2px;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: #dff6ff;
}
.sheet .switch input:checked {
    background: linear-gradient(90deg, rgba(0,211,255,.35), rgba(255,88,214,.30));
}
.sheet .switch input:checked::after {
    left: 22px;
    background: #071015;
}
.sheet .chip {
    font-size: 12px;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: #151525;
    color: #e6f6ff;
}
.sheet .chip.on {
    border-color: rgba(0,211,255,.6);
}
#overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.35);
    z-index: 58;
    display: none;
}
@media (min-width:900px) {
    .layout {
        grid-template-columns: 340px 1fr;
        gap: 16px;
    }
}
.toggle-on {
    outline: 2px solid rgba(0,211,255,.55);
}
@keyframes rippleEffect {
    to { transform: scale(4); opacity: 0; }
}

@keyframes pulseEffect {
    0% { transform: scale(0.8); opacity: 0.7; }
    70% { transform: scale(1.5); opacity: 0; }
    100% { opacity: 0; }
}

@keyframes waveEffect {
    0%, 100% { transform: scaleY(0.2); }
    50% { transform: scaleY(1); }
}

@keyframes geometricEffect {
    0% { transform: rotate(0deg) scale(1); }
    50% { transform: rotate(180deg) scale(1.5); }
    100% { transform: rotate(360deg) scale(1); }
}

/* Reproducción en segundo plano: toggle minimal sin romper .switch existente */
.bg-switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
  vertical-align: middle;
}
.bg-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.bg-slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #333;
  transition: .25s;
  border-radius: 24px;
  border: 1px solid var(--border);
}
.bg-slider:before {
  position: absolute;
  content: "";
  height: 16px; width: 16px;
  left: 4px; bottom: 4px;
  background-color: white;
  transition: .25s;
  border-radius: 50%;
}
.bg-switch input:checked + .bg-slider {
  background-color: #00d3ff;
}
.bg-switch input:checked + .bg-slider:before {
  transform: translateX(26px);
}
/* --- PATCH: keep overlay BELOW the mobile sidebar --- */
#overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.35);
  z-index: 50; /* < sidebar (55), < sheets (60) */
  display: none;
}
@media (max-width:899px){
  .sidebar{ z-index:55; 
} /* ensure sidebar stays above overlay */
}
/* --- END PATCH --- */

/* === Animated vivid background === */
:root { --orb-size: 56vmax; --orb-blur: 0px; --art: none; }
.bg-layer { position: fixed; inset: 0; z-index: -2; pointer-events: none; overflow: hidden; }
body.theme-aurora-anim .bg-layer { 
  background: radial-gradient(120vmax 120vmax at 50% 80%, rgba(0,0,0,.15), transparent 70%),
              linear-gradient(180deg, #09090e, #0b0b10);
}
.bg-layer .orb {
  position: absolute; width: var(--orb-size); height: var(--orb-size);
  border-radius: 50%; pointer-events: none; mix-blend-mode: screen;
  will-change: transform, opacity; filter: blur(var(--orb-blur));
  opacity:.28; background: radial-gradient(closest-side, rgba(0,211,255,.80), rgba(0,211,255,0) 70%);
  animation: driftA var(--tA, 38s) linear infinite, floatY var(--tB, 21s) ease-in-out infinite alternate;
}
.bg-layer .orb.magenta{ background: radial-gradient(closest-side, rgba(255,88,214,.75), rgba(255,88,214,0) 70%); opacity:.24; }
.bg-layer .orb.lime   { background: radial-gradient(closest-side, rgba(61,255,122,.70), rgba(61,255,122,0) 70%); opacity:.20; }
.bg-layer .orb.yellow { background: radial-gradient(closest-side, rgba(255,231,76,.65), rgba(255,231,76,0) 70%); opacity:.18; }
@keyframes driftA {
  0%{ transform: translate3d(-10%, -8%, 0) scale(1); }
  25%{ transform: translate3d(25%, -12%, 0) scale(1.05); }
  50%{ transform: translate3d(38%, 12%, 0) scale(0.98); }
  75%{ transform: translate3d(-12%, 22%, 0) scale(1.06); }
  100%{ transform: translate3d(-10%, -8%, 0) scale(1); }
}

@keyframes floatY {
  0%{opacity:.22;}
  50%{opacity:.32;}
  100%{opacity:.22;}
}

@media (prefers-reduced-motion: reduce){ .bg-layer .orb { animation: none !important; opacity:.14; } }
body.bg-paused .bg-layer .orb { animation-play-state: paused !important; }

/* === Audio Visualization Canvas === */
#viz { position: fixed; inset: 0; z-index: -1; pointer-events: none; opacity:.6; }
@media (max-width: 899px){ #viz { opacity:.5; } }
@media (max-width: 899px){
  .brand .logo{ font-size: clamp(22px, 5.5vw, 26px); }
}

body.viz-eco #viz { opacity:.35; }
body.viz-off #viz { display:none !important; 
}
/* overlay under sidebar */
#overlay { z-index: 50 !important; }
@media (max-width:899px){ .sidebar{ z-index: 60; } 
}
/* === PATCH: Quitar switch de crossfade duplicado en móvil === */
/* En móviles, esconder el switch de ESCRITORIO si coexistieran ambos */
@media (max-width:899px){
  /* Oculta el input por id */
  #crossfadeToggle_d { display:none !important; 
}
  /* Si el input está dentro de un label.switch o fila contenedora, ocúltalos también */
  label.switch:has(#crossfadeToggle_d) { display:none !important; }
  .row:has(#crossfadeToggle_d) { display:none !important; }
}
/* Opcional (coherencia): en escritorio, esconder el switch de MÓVIL si ambos existen */
@media (min-width:900px){
  #crossfadeToggle_m { display:none !important; }
  label.switch:has(#crossfadeToggle_m) { display:none !important; }
  .row:has(#crossfadeToggle_m) { display:none !important; }
}
/* === END PATCH === */

/* === Track thumbnails === */
.track-row{ display:grid; grid-template-columns: 44px 1fr auto auto; gap:12px; align-items:center; }
.track-row .t-left{ width:44px; height:44px; border-radius:8px; overflow:hidden; background:#0f0f18; }
.track-row .t-cover{ width:100%; height:100%; object-fit:cover; display:block; }
.track-row .t-title{ display:flex; gap:8px; align-items:center; }
@media (min-width:900px){
  .track-row{ grid-template-columns: 52px 1fr auto auto; }
  .track-row .t-left{ width:52px; height:52px; }
}
/* === Brand (logo image + site name) === */
.brand{display:flex;align-items:center;gap:10px;min-width:0}
.brand-logo{width: 32px;height: 32px;object-fit:contain;border-radius:10px;box-shadow:0 0 18px rgba(0,211,255,.28)}
@media (min-width:900px){.brand-logo{width:44px;height:44px}}

/* === Mobile header: 2 rows, centered brand === */
@media (max-width: 899px){
  header{
    display:grid;
    grid-template-columns: 1fr auto 1fr;
    grid-template-areas:
      "menu brand settings"
      "search search search";
    gap:10px;
    align-items:center;
  }
  #menu{ grid-area: menu; justify-self:start; }
  .brand{ grid-area: brand; justify-self:center; display:flex; align-items:center; gap:8px; }
  #filtersBtn{ grid-area: settings; justify-self:end; }
  header .search{ grid-area: search; 
}
  /* logo más compacto en móvil */
  .brand-logo{ width: 32px; height: 32px; }
}
/* === Neon magnifying glass inside search === */
.search{ position:relative; display:flex; align-items:center; }
.search .search-icon{
  position:absolute;
  left:14px;
  width:22px;
  height:22px;
  pointer-events:none;
}
.search input{
  width:100%;
  padding:12px 14px 12px 48px; /* deja lugar a la lupita */
}
/* === Mini player: evitar overflow horizontal en móvil (títulos largos con puntos suspensivos) === */
@media (max-width: 899px){
  .mini { overflow: hidden; }
  .mini .row { min-width: 0; }             /* permite que los hijos se contraigan */
  .mini .cover { flex-shrink: 0; }
  .mini .btns, .mini details.mini-menu { flex-shrink: 0; }
  /* Asegura elipsis en el texto del mini player, sin romper la estructura vertical */
  .mini .title,
  #mini-title,
  #mini-artist {
    display: block;
    flex: 1 1 auto;
    min-width: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
}

/* === HARDEN: Mini player mobile overflow guard === */
@media (max-width: 899px){
  /* Global safety net to avoid accidental horizontal scroll */
  html, body { overflow-x: hidden; }

  /* Mini width strictly within viewport gutters */
  #mini { max-width: calc(100% - 24px); }

  /* Single-line row; allow items to shrink */
  .mini .row{
    flex-wrap: nowrap;
    min-width: 0;
  }
  /* Ensure all flex children can shrink (except fixed-size controls/cover) */
  .mini .row > *{
    min-width: 0;
  }
  .mini .cover,
  .mini .btns,
  .mini details.mini-menu{
    flex: 0 0 auto; /* no shrinking for controls & cover */
  }

  /* Ellipsis for textual ids/classes used by the script */
  #mini-title, #mini-artist, .mini .title{
    display: block;
    max-width: 100%;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
}

/* === Patch: truncado y layout para títulos de pistas (playlist/track rows) === */
.t-title {
    display: flex;
    gap: 10px;
    align-items: center;
    min-width: 0;
    flex: 1;
}

.t-title .name {
    font-weight: 700;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    min-width: 0;
    flex: 1;
}

/* === Patch: nombres largos y grid de filas de pista === */
.t-title {
    display: flex;
    gap: 10px;
    align-items: center;
    min-width: 0;
    flex: 1;
}

.t-title .name {
    font-weight: 700;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    min-width: 0;
    flex: 1;
}

/* Asegurar que las pistas en playlists tengan buen espaciado */
.track-row {
    padding: 14px;
    grid-template-columns: 44px 1fr auto auto;
}

/* === ESTILOS ESPECÍFICOS PARA PLAYLISTS === */
.pl-track-row {
  display: grid;
  grid-template-columns: 44px 1fr auto auto;
  gap: 12px;
  align-items: center;
  padding: 14px;
  border-top: 1px solid rgba(255,255,255,.06);
  transition: var(--hover-transition);
}

/* Permitir títulos de álbum completos en la vista de resultados (escritorio y móvil) */
.album .meta .title {
  /* Aceptar múltiples líneas y evitar recortes en nombres largos */
  white-space: normal;
  word-break: break-word;
  overflow-wrap: anywhere;
  line-height: 1.25;
}

.pl-track-row:hover {
  background: rgba(255,255,255,0.05);
  transform: translateX(5px);
  box-shadow: var(--hover-glow);
}

.pl-track-row .t-left {
  width: 44px;
  height: 44px;
  border-radius: 8px;
  overflow: hidden;
  background: #0f0f18;
}

.pl-track-row .t-cover {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

.pl-track-row .t-title {
  display: flex;
  gap: 8px;
  align-items: center;
  min-width: 0;
  flex: 1;
}

/* Playlist track names: permitir que los títulos se muestren completos sin cortarse */
.pl-track-row .t-title .name {
  font-weight: 700;
  /* Permitir saltos de línea cuando el nombre es muy largo */
  white-space: normal;
  word-break: break-word;
  overflow-wrap: anywhere;
  line-height: 1.25;
  /* Asegurar que el nombre tome el espacio disponible dentro de la fila */
  min-width: 0;
  flex: 1;
}

@media (min-width:900px){
  .pl-track-row {
    grid-template-columns: 52px 1fr auto auto;
  }
  .pl-track-row .t-left {
    width: 52px;
    height: 52px;
  }
}

/* === Home Shelf (Últimos de Alquimix) === */
.home-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 11px;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: .06em;
    padding: 6px 8px;
    margin: 6px 0 2px;
    opacity: .9;
}
.home-title .alq-star {
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:18px;height:18px;border-radius:50%;
    background: linear-gradient(90deg, rgba(0,211,255,.28), rgba(61,255,122,.28));
    border: 1px solid rgba(61,255,122,.45);
    color:#d8ffec;
    font-size: 12px;
}

/* === Home shelf (Contenido inicial dinámico) === */
.home-shelf {
    background: #101018;
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 12px;
}
.home-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    margin-bottom: 10px;
}
.home-header h2 {
    font-size: clamp(16px, 2vw, 18px);
}
.home-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0,1fr));
    gap: 10px;
}
@media (min-width: 600px) {
  .home-grid { grid-template-columns: repeat(3, minmax(0,1fr)); }
}
@media (min-width: 900px) {
  .home-grid { grid-template-columns: repeat(4, minmax(0,1fr)); }
}
.home-card {
    display: grid;
    grid-template-rows: auto auto;
    gap: 8px;
    background: #0f0f16;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px;
    cursor: pointer;
    transition: var(--hover-transition);
}
.home-card:hover {
    transform: translateY(-3px);
    box-shadow: var(--hover-glow);
    border-color: var(--a1);
}
.home-card .cover {
    width: 100%;
    aspect-ratio: 1;
    border-radius: 10px;
    object-fit: cover;
    background: #0f0f16;
}
.home-meta {
    min-width: 0;
}
.home-title {
    font-weight: 700;
    /* Permitir títulos de recomendaciones de largo arbitrario sin truncar */
    white-space: normal;
    word-break: break-word;
    overflow-wrap: anywhere;
    line-height: 1.25;
}
.home-sub {
    font-size: 12px;
    color: #9fb2c6;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* === Correcciones: Imágenes 1:1 sin recorte (Responsive, min/max) === */
:root {
  --cover-min: 80px;
  --cover-max: 220px;
}
/* Portadas en la grilla de recomendaciones */
.home-card .cover {
  aspect-ratio: 1 / 1;
  object-fit: contain !important;
  width: 100%;
  max-width: var(--cover-max);
  background: #0f0f16;
  image-rendering: auto;
}
/* Portadas en listas laterales */
.cover {
  aspect-ratio: 1 / 1;
  width: 56px;
  height: auto !important;
  object-fit: contain !important;
  background: #0f0f16;
}
/* Portada del héroe del álbum */
.album-hero .hero-cover {
  aspect-ratio: 1 / 1;
  object-fit: contain !important;
  width: clamp(100px, 18vw, var(--cover-max));
  height: auto !important;
  background: #0f0f16;
}
/* Portada del reproductor */
.p-cover {
  aspect-ratio: 1 / 1;
  width: clamp(44px, 7vw, 64px);
  height: auto !important;
  object-fit: contain !important;
  background: #0f0f16;
}
/* Portadas en miniplayer/playlist rows */
.mini .cover,
.pl-track-row .t-cover {
  aspect-ratio: 1 / 1;
  object-fit: contain !important;
}

/* === Mobile header safe spacing & shelf separation === */
@supports (scroll-padding-top: 10px) {
  html, body { scroll-padding-top: var(--header-h, 64px); }
}
@media (max-width: 899px) {
  header {
    padding-top: calc(10px + env(safe-area-inset-top));
    z-index: 100; /* asegurar que quede por encima de tarjetas */
  }
  /* Espaciado amigable bajo el header en móvil */
  .content { padding-top: max(8px, calc(var(--header-h, 64px) * 0.10)); }
  /* Si los recomendados son lo primero, separarlos del header */
  .content > .home-shelf:first-child { margin-top: 6px; }
  /* Evitar que elementos se "metan" debajo en stacking context raros */
  .home-shelf, .album-hero, .pl, #tracks { position: relative; z-index: 0; }
}
/* Borde/sombra sutil para separar header del contenido cuando es sticky */
header { box-shadow: 0 1px 0 var(--border); }

#homeShelf { display: block; }

/* Placeholder para shelf vacío */
.home-empty {
    display: grid;
    place-items: center;
    min-height: 120px;
    font-size: 0.95rem;
    color: var(--muted, #888);
    border: 1px dashed var(--border, #ddd);
    border-radius: 12px;
}

/* === Hero fixes (imagen + texto al abrir recomendado) === */
.album-hero > div { 
    min-width: 0; /* necesario para que el ellipsis funcione en grids/flex */
}
/* Permitir títulos y subtítulos largos en el héroe del álbum */
.album-hero h1 {
    white-space: normal;
    overflow-wrap: anywhere;
    max-width: 100%;
}
.album-hero .sub {
    white-space: normal;
    overflow-wrap: anywhere;
    max-width: 100%;
}
.album-hero .hero-cover {
    max-width: 100%;
    height: auto;
}

.tracks { margin-top: 4px; }

/* === Mobile readability: multi-line titles without breaking responsiveness === */
@media (max-width: 899px) {
  /* Tracklist: permitir múltiples líneas para nombres de temas */
  .t-title { align-items: flex-start; }
  .t-title .name {
    white-space: normal;
    /* Mostrar texto completo sin cortar ni añadir puntos suspensivos */
    word-break: break-word;
    overflow-wrap: anywhere;
    line-height: 1.25;
  }

  /* Sidebar: mostrar títulos de álbum completos sin truncar */
  .album .meta { min-width: 0; }
  .album .meta .title {
    white-space: normal;
    /* Mostrar texto completo sin cortar ni añadir puntos suspensivos */
    word-break: break-word;
    overflow-wrap: anywhere;
    line-height: 1.25;
  }
}

/* En pantallas muy angostas, liberar espacio ocultando el contador de descargas */
@media (max-width: 600px) {
  .album { grid-template-columns: 56px 1fr; }
  .album .downloads { display: none; }
}

/* === Mobile: títulos sin corte en hero y recomendados === */
@media (max-width: 899px) {
  /* Hero del álbum: hasta 3 líneas */
  .album-hero h1 {
    white-space: normal;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    /* Define la propiedad estándar para compatibilidad */
    line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    word-break: break-word;
    line-height: 1.25;
  }

  /* Recomendados: hasta 2 líneas en título */
  .home-meta { min-width: 0; }
  .home-title {
    white-space: normal;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    /* Define la propiedad estándar para compatibilidad */
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    word-break: break-word;
    line-height: 1.2;
  }
}

/* === Desktop guard: keep recommended cards below sticky header === */
@media (min-width:900px){
  .home-shelf, .home-grid, .home-card{
    position: relative;
    z-index: 0;
  }
}

/* === VLC-like fullscreen overlay === */
@media (min-width:900px){
  .viz-fs.full{
    position: fixed;
    inset: 0;
    z-index: 2001;               /* over visuals, under player (player z is 2002 in party-mode) */
    background: rgba(0,0,0,.8);  /* dark semi-transparent */
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: auto;
  }
  .viz-center{
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    text-align: center;
    color: #fff;
  }
  .viz-center .art{
    width: 300px; height: 300px;
    max-width: 50vw; max-height: 50vh;
    object-fit: cover;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,.55);
  }
  .viz-center .t1{
    font-weight: 800;
    font-size: clamp(18px, 2.4vw, 28px);
    line-height: 1.15;
  }
  .viz-ctrls{
    display: inline-flex;
    gap: 18px;
    align-items: center;
    justify-content: center;
  }
  .viz-ctrls .btn{
    font-size: 18px;
    padding: 10px 14px;
    border-radius: 12px;
    border: 0;
    background: rgba(255,255,255,.08);
    color: #fff;
    cursor: pointer;
  }
  .viz-ctrls .btn:hover{
    background: rgba(255,255,255,.16);
  }
  /* Visuals behind everything in full */
  .viz-canvas.full{ z-index: 2000; }
}

/* === PATCH: Desktop fullscreen layering & exit === */
@media (min-width:900px){
  .viz-fs.full{
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent !important;
    z-index: 2100; /* below player */
  }
  .viz-fs.full::before{
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,.72);
    z-index: 0;
  }
  .viz-fs .viz-canvas{
    position: absolute;
    inset: 0;
    opacity: .85;
    pointer-events: none;
    z-index: 1 !important; /* over black */
  }
  .viz-fs .viz-center{
    position: relative;
    z-index: 2; /* over visuals */
  }
  .viz-fs .viz-exit{
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 8px 12px;
    border: 0;
    border-radius: 12px;
    background: rgba(0,0,0,.55);
    color: #fff;
    cursor: pointer;
    font-weight: 700;
  }
  .viz-fs .viz-exit:hover{ background: rgba(255,255,255,.16); }
  .player{ z-index: 2200; }
}
/* === END PATCH === */

/* Color controls in fullscreen overlay */
@media (min-width:900px){
  .viz-colors{ margin-top: 12px; display:flex; gap:10px; align-items:center; justify-content:center; }
  .viz-colors .colorctl{ display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:10px; background: rgba(255,255,255,.06); }
  .viz-colors input[type="color"]{ width:36px; height:28px; padding:0; border:0; background:transparent; cursor:pointer; }
  .viz-colors span{ font-size:13px; opacity:.9; }
}

/* === Móvil: mejoras de accesibilidad y transición del menú === */
@media (max-width: 899px){
  /* Botón hamburguesa: área táctil mínima 44x44 */
  #menu {
    min-width: 44px;
    min-height: 44px;
  }
  /* Forzamos transición del sidebar <= 200ms sin afectar escritorio */
  .sidebar {
    transition: transform .2s ease !important;
    will-change: transform;
  }
  /* Overlay para cerrar al tocar fuera (sólo móvil) */
  #sidebar-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.3);
    display: none;
    z-index: 999; /* detrás del sidebar si este usa >999, ajustar si es necesario */
    touch-action: manipulation;
  }
}

@media (max-width:899px){
  #menu{min-width:44px;min-height:44px}
}

/* === Final mobile overlay/sidebar stacking (authoritative) === */
@media (max-width:899px){
  .sidebar{ z-index: 60; }
}
#overlay{ z-index: 50 !important; }

/* === Mobile sidebar overlay + arrow rotation (minimal override) === */
@media (max-width:899px){
  .sidebar{
    z-index: 130;
    top: calc(var(--header-h, 64px));
  }
}
.sidebar summary > span{ display:inline-block; transition: transform .2s ease; }
.sidebar details[open] > summary > span{ transform: rotate(-180deg); }
/* === end overrides === */
